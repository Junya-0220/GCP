# ComputeEngine

## 19 ComputeEngine 仮想マシンを作成出来るサービス

### ComputeEngineとは

ComputeEngineとは、ハードウェア とは購入することなくオンデマンドで仮想マシンを利用できるコンピューティングサービスです。
ComputeEngineでは仮想マシンが仮想マシンを実行するための ソフトウェアであるハイパーバイザー上で複数実行されます。
ComputeEngineでは仮想マシン上のゲストOS CPUのコア数、メモリ容量といった構成をApp EngneやCloud Functionsといった他のGoogle Cloudのサービスより細かく設定できます。
 また一般的なアクセスの増加といった負荷の変動に応じて仮想マシンの台数を柔軟にスケールスケールアウトできます
  noComputeEngineでは何かサービスを提供しているマシンと言う機能的な意味と区別するために実際に動作している物理的な意味での仮想マシンをインスタンスと呼びます

### リソースの追加や削除がすぐに行える
システムを構築する際音プレミスだとハードウェアサーバーやネットワーク機器 アライアンス機器等の調達やデータセンター等の設置場所の確保といった初期投資が必要です
しかしComputeEngineではこのような先行投資は不要です必要な時に必要なリソースがすぐに追加でき利用しない場合は直ちに停止削除ができます
必要なのは運用し月次で発生するクラウドの利用料のみです。
ミニマムな構成でスタートしユーザ数やシステムの希望に合わせて仮想マシンを追加するといった柔軟な対応をとることができます。

* オンプレミスとComputeEngineの比較


| 項目 | オンプレミス | ComputeEngine |
| --- | --- | --- |
| OS | 柔軟に選択可能 | 提供されるイメージから選択 |
| ハードウェア | 自分で用意 | クラウドベンダーが用意 |
| 準備期間 | ハードウェアの調達期間を含めて数ヶ月 | 不要 |
| 費用 | 初期投資の費用＋運用費 | 運用費(ライセンス含む) |
| 運用・保守 | データセンターで運用・保守 | インターネット経由で運用・保守 |
| カスタマイズ | 全ての領域でカスタマイズ | 全ての領域でカスタマイズ |

### ComputeEngineはIaaS

コンピュートエンジンはGoogle Cloudが提供しているやつですそのためアプリケーションやミドルウェアOSについてはユーザが管理する必要があります
あぁ子と比較すると管理する範囲が広い反面ユーザが自由に設定できる範囲が大きいと言うメリットがあります
なおコンピュート園児には障害発生時の対応としてLiveマイグレーションとポストエラー対応と言う大きく2つの機能が備わっています
次はこの2つの機能について解説します

### 障害発生時の対応ライブマイグレーション

liveマイグレーションとは仮想マシンを稼働した状態のまま仮想マシンを執行する物理サーバーを別の物理サーバーに移動する仕組みです
これにより物理サーバーのメンテナンスなど物理サーバーを停止する必要がある場合でも仮想マシンの稼働を継続できます
サーバーのメンテナンスに伴う計画停止のほかハードウェア障害を検知した際にもLiveマイグレーション機能に影響のない障害であればLiveマイグレーションが行われます
湯沢Liveマイグレーション後特に意識する必要はありません
検知されたイベントに対するメンテナンスや 障害対応はGoogleによって行われます
ただしハードウェア障害が発生した場合Liveマイグレーションが必ず行われるわけではありません
ハードウェアが完全に故障した場合などLiveマイグレーションができないときは後述のポストエラーが検知され仮想マシンは再起動されます
なおGPUが割り当てられたインスタンスとプリエンプティブ属性を持ったインスタンスはLiveマイグレーションが実施されず仮想マシンは停止されるので注意が必要です

### 障害発生時の対応ホストエラー

ホストエラーとはハードウェア障害(仮想マシンをポストしている物理サーバーが完全に故障してクラッシュするなど)により仮想マシンの停止が発生することです
ホストエラーが発生すると仮想マシンの再起動が発生するので仮想マシンが停止してから起動が 旅をするまでの間仮想マシンは利用できません
仮想マシンの停止につながるようなハードウェア障害が実際に発生するのはまれです
しかし起こりうる障害からアプリケーションやシステムを守るため単一の障害でシステムが停止しないような設計が必要です
システム干支を始めとする運用に置いてポストエラーは必ず考慮する必要があります

### まとめ

コンピュートエンジンはオンデマンドで仮想マシンを利用できるコンピューティングサービス
コンピュートエンジンはリソースの追加や削除をすぐに行える

## 20 ComputeEngineを使う流れ

### ComuteEngineを使う流れ

コンピュートエンジンを使うにはまずはGoogleクラウドでプロジェクトを作成する必要があります
そして管理者よりコンピュートエンジンのリソースを操作する権限を付与してもらうことでインスタンスを作成できるようになります
インスタンスを作成した後はクラウドセリアSSH接続を用いてインスタンスにアクセスしてソフトウェアのインストールといった構築作業を行います

### インスタンスの設定項目

 コンピュートエンジンの仮想マシン(インスタンス)は必要な項目を入力して作成ボタンをクリックするだけで作成できます
  インスタンスの作成はGoogle Cloudコンソールからおこないます
   インスタンス作成画面では次の情報を入力します
    なおインスタンスの名前は1つのプロジェクト内で1の名前にする必要があります
     リージョンが異なる場合でも11にする必要があるため注意が必要です

* インスタンスの設定項目


| 設定項目 | 説明 |
| --- | --- |
| 名前 | インスタンスの名前(Linuxインスタンスであればホスト名) |
| リージョン | リソースを実行できる特定の地理的なロケーション |
| ゾーン | リージョン内の分離された場所 |
| マシンタイプファミリー | マシンタイプをグループ化したもの。<br>汎用、メモリ最適化、コンピューティング最適化、GPUからの選択 |
| シリーズ | CPUプラットフォームの世代 |
| マシンタイプ | インスタンスのサイズ(vCPU数、メモリ) |
| ブートディスク | 利用OSとディスクサイズ |
| サービスアカウント | インスタンス内で使うGoogleCloudのサービスアカウント |
| アクセススコープ | APIアクセス権のタイプとレベル |


* インスタンスの任意設定項目


| 設定項目 | 説明 |
| --- | --- |
| ラベル | インスタンスの識別子 |
| ファイアウォールルール | インターネットからの特定のネットワークトラフィックを許可<br>(インスタンス作成画面ではHTTPとHTTPSを選択可能) |
| 削除からの保護 | インスタンスの削除を防止 |
| 説明 | インスタンスの説明 |
| 起動スクリプト | 起動時に実行されるスクリプト |
| プリエンティブル | 低価格で利用できる最大24時間有効なインスタンスとして作成するためのオプション |
| ネットワークタグ | 特定のインスタンスにファイアウォールルール<br>ルールを適用する場合に使用 |

* ディスクとネットワークに関する任意設定項目


| 設定項目 | 説明 |
| --- | --- |
| 追加ディスク | インスタンスブートディスクとは別にディスクを追加する<br> |
| ネットワーク | どのVPC (Google Cloudのネットワークサービス。)内に作るかを指定する<br>(初期設定ではデフォルト) |
| サブネットワーク | VPC内のサブネットの選択(初期設定ではデフォルト) |
| プライマリ内部IP | 「エフェメラル (自動)」「 エフェメラル (カスタム)」「 IPアドレスの作成」から選択。<br>(初期設定では「エフェメラル(自動)」) |
| 外部IP | なし、エフェメラル、IPアドレスの作成から選択 |
| ネットワークサービス階層 | ネットワークの品質パフォーマンスとプロジェクト費用のバランスを最適化する機能<br>スタンダードかプレミアムを選択する(初期設定ではプレミアム) |
| IP転送 | パケットのルーティング |
| パブリックDNS PTRレコード | パブリックの逆引きDNSを入力し、外部IPアドレスに関連付けさせる。(初期設定ではオフ) |

これらの設定を行い作成ボタンを押すとインスタンスが起動します
このようにインスタンスを作成する際は様々な情報を入力する必要があります
作成時に入力必須項目はありますが入力24項目は後から進行ができるので手軽に作成できる
必須項目の入力ミスなのですが違えてインスタンスを作成した場合気軽に削除して作り直すことが可能です

### ComputeEngineで利用できるOS

コンピュートエンジンでは、インスタンスを作成時に様々なOSを選択できます。
OSは、OSを含めてパッケージ化されたデータであるイメージとして公開されています
コンピュートエンジンで利用できる公開イメージは次のものになります。
これらのイメージからOSのバージョンを選んでインスタンスを作成します。

* 主な公開イメージ

| OS | 説明 |
| --- | --- |
| Debian | Debian Projectによって開発されているLinuxディストリビューション。<br>主なパッケージ管理システムはAPT |
| Ubuntu | Canonical Ltdから支援を受けて開発されているDebianをベースとした<br>Linuxデストリビューション。主なパッケージ管理はAPT |
| CentOS | RHELクローンのLinuxディストリビューションで、RedHatが支援しているプロジェクト。<br>主なパッケージ管理ツールはrpmやyum |
| Fedora CentOS | Linuxカーネルをベースにしたオープンソースで軽量なOS |
| Container Optimized OS | Dockerの実行に最適化されたOS |

 公開イメージは基本的には無料ですが公開イメージとは別にプレミアムイメージと呼ばれる有料のイメージもあります。

* プレミアムイメージ

| OS | 説明 |
| --- | --- |
| Red Hat Enterprise Linux(RHWL) | Red Hatが開発している業務むけのLinuxディストリビューション |
| SUSE Linux Enterprise | SUSEが開発している業務向けのLinuxディストリビューション |
| Windows Server | MicroSoftから発売されているサーバー専用のWindows OS |


 プレミアムイメージにはオンデマンドライセンスとサブスクリプション持ち込みのBYO(Brin-Your-Own-Subscription)の2種類があります。
どちらで提供されているかはOSのバージョンなどによって異なります
オンデマンドライセンスの場合コンピュートエンジンの利用料にライセンス料が追加されます
BYOSの場合は既存のサブスクリプションまたはライセンスをGoogleが提供しているイメージに適用できます。

### まとめ

コンピュートエンジンインスタンスはGoogle Cloudコンソールから気軽に作成可能
設定項目は必須項目と任意で入力できる項目が存在する
インスタンスの作成時に様々なOSを選択できる


## 21 ComputeEngineの料金

### ComputeEngineの料金
コンピュートエンジンの料金は従量課金制です。
使用量に応じて課金され最初の1分を超えるとその後は1秒単位で課金されます
インスタンスを起動した後1分以内に停止した場合は1分間の使用料金が発生します
このようにコンピュートエンジン従量課金制なのでインスタンスを作成前に月間コストの見積もりを算出してから作成することをお勧めします
コストを算出する際は主に次の3つの要素を考慮する必要があります。
    
