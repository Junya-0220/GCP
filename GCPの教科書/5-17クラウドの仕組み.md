# クラウドの仕組み

## 5 クラウドとは

Google Cloudはクラウドコンピューティングを提供するサービスです。
GoogleCloudのサービスやしくみを紹介する前に、そもそもクラウドとは何かを解説しておきましょう。

### クラウドとは

<span style="color:crimson; font-weight:bold;">クラウド</span>とは、クラウドベンダーであるプロバイダーがインターネットなどのネットワーク経由で、ITリソースを提供するサービスのことです。

### ネットワーク経由で簡単に使える

クラウドはネットワーク経由で利用します。WebブラウザがあればITリソースを使用できます。

### クラウドが与えるビジネスへの影響

クラウドを活用した企業は<span style="color:crimson; font-weight:bold;">インフラへの初期投資を抑え、運用経費主体のコスト構造に変換できます。</span>
ビジネス環境に柔軟に対応できます。
システム開発の期間を短縮できます。

### オンプレミスとは
<span style="color:crimson; font-weight:bold;">オンプレミス(on-premiss)</span>は、
システムを構成するハードウェア・ソフトウェアを自社施設やデータセンターに導入し、インフラ資源を主体的に管理する運用形態のことです。
クラウドと比較すると、<span style="color:crimson; font-weight:bold;">インフラ資源を自社の利用用途に応じて自由にカスタマイズできます。</span>

* システム管理の側面から見るオンプレミスとクラウドの違い

| 項目 | オンプレミス | クラウド |
| --- | --- | --- |
| 責任範囲の広さ | 基本的に全範囲 | 役割分担に基づき責任範囲が決まる |
| カスタマイズ性 | 自由にカスタマイズできる | カスタマイズできる範囲は限定される |
| システム導入 | 初期投資が必要で、調達や初期構築に時間がかかる | 初期投資不要ですぐ使える |
| 変更管理 | 自由に変更できる | クラウドの仕様に基づいた変更管理 |
| システム保守 | アプリケーションだけでなく、ハードウェアやソフトウェアの保守が必要 | アプリケーションなど、ユーザーの責任範囲に限定した保守作業 |

### クラウドが提供する価値は実にさまざま

クラウドを使うと最先端技術をタイムリーに使えます。
データ分析や機械学習などの技術を使えます。
デジタル変革につながるような開発ができます。

* クラウドが提供する価値

| 項目 | オンプレミス | クラウド |
| --- | --- | --- |
| 責任範囲の広さ | 基本的に全範囲 | 役割分担に基づき責任範囲が決まる |
| カスタマイズ性 | 自由にカスタマイズできる | カスタマイズできる範囲は限定される |
| システム導入 | 初期投資が必要で、調達や初期構築に時間がかかる | 初期投資不要ですぐ使える |
| 変更管理 | 自由に変更できる | クラウドの仕様に基づいた変更管理 |
| システム保守 | アプリケーションだけでなく、ハードウェアやソフトウェアの保守が必要 | アプリケーションなど、ユーザーの責任範囲に限定した保守作業 |

### まとめ

* クラウドとは、クラウドベンダーがネットワーク経由でITリソースを提供するサービスのこと
* クラウドは変革を実現するためのさまざまな価値(柔軟性やコスト削減、先端技術)などを提供する

## 6　 パブリッククラウドとプライベートクラウド

クラウドにはパブリッククラウドとプライベートクラウドの2種類の形態があります。
GoogleCloudは、前者のパブリッククラウドです。GoogleCloudを深く理解するためにも、それぞれの特徴を掴んでおきましょう。

### クラウドの利用形態は大きく2種類ある

クラウドは利用形態によって<span style="color:crimson; font-weight:bold;">パブリッククラウド</span>と<span style="color:crimson; font-weight:bold;">プライベートクラウド</span>の２種類に分かれます。
パブリッククラウドとは、<span style="color:crimson; font-weight:bold;">クラウドベンダーが提供する従量課金制のサービスをインターネットを通じて利用するものです。</span>
プライベtーとクラウドとは、オンプレミスとパブリッククラウドの両方の特性を持つクラウドのことです。<span style="color:crimson; font-weight:bold;">パブリッククラウドに近い構成を、自社のデータセンターにユーザー自身が用意します。</span>

### パブリッククラウドとプライベートクラウドの違い


### まとめ

* パブリッククラウド、プライベートクラウド、オンプレミスは用途にあわせて選択する必要がある

## 7 IaaS,PaaS,SaaS

クラウドは、サービスの提供範囲によって大きく3つに分類されます。
実際にシステム開発をするときに、どのサービスを選べば良いかを検討する際に目安になるので、それぞれの提供形態と特徴を見ておきましょう

### クラウドの提供形式

<span style="color:crimson; font-weight:bold;">IaaS(イアース)</span>
サーバーやストレージ、ネットワークといった<span style="color:crimson; font-weight:bold;">インフラを提供するサービス</span>です。
パブリッククラウドで一番使われているのは、IaaSになるでしょう。
GoogleCloudでは、仮想マシンを提供するComputeEngineや仮想ネットワークを提供するComputeEngineや、仮想ネットワークを提供するVirtual Private Cloudが代表的なサービスです。

<span style="color:crimson; font-weight:bold;">PaaS</span>は、<span style="color:crimson; font-weight:bold;">プラットフォームを提供するサービス</span>です。
クラウドベンダーが開発・運用するアプリケーションサーバーなどのミドルウェア環境を利用できます。
<span style="color:crimson; font-weight:bold;">SaaS</span>は、<span style="color:crimson; font-weight:bold;">インフラやプラットフォームだけでなく、アプリケーションも提供するサービス</span>です。
企業向けのGmailやGoogleMeetなどが含まれるGoogleWorkspaceが代表的なサービスです。
このようにIaaS、PaaS、SaaSではそれぞれ提供するサービスの範囲や特徴が異なります。
それぞれの特性や提供されるサービスの仕様をよく理解した上で使うことが大切です。

### IaaS,PaaS,SaaSを選ぶ基準

IaaS,PaaS,SaaSを選ぶ基準について下記にまとめます。

| 項目 | メリット | デメリット |
| --- | --- | --- |
| IaaS | オンプレミス同様のシステム開発ができる。カスタマイズ性が高い。 | アプリ開発やサーバー構築はオンプレミス同様の工数が掛かる |
| PaaS | クラウドベンダーが提供する最新のミドルウェアがすぐに使える。<br>インフラのメンテナンス負担が少ない。(あるいはメンテナンスフリー) | IaaSに比べてインフラのカスタマイズは限定的。ミドルウェアのライフサイクルはクラウドベンダーが規定する |
| SaaS | 完成されたアプリケーションがすぐに使える。<br>インフラのメンテナンスが不要。 | インフラのカスタマイズは出来ない。アプリケーションのカスタマイズも限定的 |


### まとめ

* クラウドには主にIaaS,PaaS,SaaSの提供形態が存在する

## 8 The Datacenter as a Computer

GoogleCloudは、「The Datacenter as a Computer」という論文に記載された「Warehouse-Scale Computer」という考え方に基づいて設計されています。
GoogleCloudを深く理解するためにも、概要を理解しておきましょう。

### The Datacenter as a Computerとは

通常、オンプレミスでシステムを作る際に、多くの組織では１あるいは２、３拠点程度のデータセンターにインフラ資源を集約します。
そして、システムごとに最適なハードウェアやソフトウェアの組み合わせるため、さまざまなハードウェアやソフトウェアが混在するような形になります。

一方、Googleでは<span style="color:crimson; font-weight:bold;">The Datacenter as a Computer</span>の論文に記載された<span style="color:crimson; font-weight:bold;">Warehouse-Scale Computer</span>と呼ばれる設計の考え方でインフラを標準化し、共通のインフラを世界中に展開しています。


### WSCのポイント①　インフラ設計の標準化

インフラを構成するラックやサーバー、ストレージ、ネットワークの設計を標準化し、世界中に展開しています。

### WSCのポイント②　インフラを１つのコンピュータのように扱う

「WSC」と呼ばれる、大きな倉庫のようなスケールのデータセンターにおけるインフラを、あたかも１つのコンピュータのように扱えるようにします。
そのおかげでアプリケーションは、個別のサーバーを意識することなく、大量のサーバーを使用した大規模な分散処理を実現できるようになります。

### WSCのポイント③　大規模分散処理の実現

Googleの大規模分散処理は、Google独自のソフトウェア技術を使うことで実現されています。それによって、CPUやメモリ、電源といったインフラ資源を効率的に活用できるようになります。
オンプレミスの場合、インフラ資源はピーク時の利用を想定して割り当てられるため、通常時はCPUやメモリの利用率は低くなります。
しかしGoogleのように大規模なサービスを展開している場合は、世界中にあるWSCに処理を分散し、ピークを平準化することでCPUやメモリの利用率を高められます。
Googleは、WSCの設計をクルドのサービスに適用することで、コスト効率が高く、高いパフォーマンスのサービスを世界中に展開しています。

### Googleのデータセンターの設計

WSCを構成するためのデータセンターの設計についてさまざまな点が触れられています。

重視しているのが、<span style="color:crimson; font-weight:bold;">標準構成のサーバーの利用とソフトウェア技術の活用</span>です。
特殊なハードウェア技術に頼るのではなく、ハードウェアはあくまで標準のハードウェアを活用し、ネットワーキングやストレージ、インフラ運用などに関するGoogle独自のソフトウェア技術を活用しています。

次に、<span style="color:crimson; font-weight:bold;">高いエネルギー効率の実現</span>です。
データセンターの中でも電力消費が大きい部分を中心に、電力消費を抑えるように設計することでコストを抑制します。
最後に、<span style="color:crimson; font-weight:bold;">障害発生を前提とした運用</span>をすることです。
ハードウェア障害が数時間単位といった時間で発生する前提とし、たとえ障害がおきても利用者には影響を与えないためのシステム設計を行っています。
こうした設計を行うことで、その時代のトレンドに合わせた技術をタイムリーに取込、コストパフォーマンスが高い、安定したサービスを提供することが出来るようになります。

| 項目 | 設計ポイント |
| --- | --- |
| 標準構成のサーバー | メインフレームといった特殊なハードウェアではなく、標準構成のサーバーを大量に使用する。<br>特殊なハードウェア機能に依存したシステム設計にしない |
| ストレージ | 物理ディスクは各サーバーのローカルにあるものを使用するが、Google独自のソフトウェア技術を活用してデータの冗長化を実現している。<br>時代の特性にあわせて、SSDなどの新しいデバイスを採用してきた |
| ネットワーク | 各ローカルのネットワークやラックスイッチでは40Gbsおよび100Gbsといった標準で使う帯域のポートを利用し、データセンタースイッチでそれらのポートを束ねる構成とする |
| 電力消費の抑制 | データセンターの中で一番電力を消費するCPUやメモリの電力消費を抑える工夫をする |
| ハードウェア障害の対処 | インターネットサービスを使う上でサーバーのハードウェア故障率は通常より高まる傾向がある。そのため、１時間単位でハードウェア障害が発生する前提で、対象外設計や運用を検討する |

## 9 グローバルなインフラ


### グローバルなプライベートネットワーク

GoogleCloudは200以上の国と地域で利用でき、27のリージョンと82のゾーンで構成されています。
また、GoogleCloudのサービスのネットワークには、GmailやGoogle検索、YouTubeなっどのプロダクトを支えるネットワークと同じものが使われています。
この高機能かつ低レイテンシなプライベートネットワークを活用することで、豊かなユーザーエクスペリエンスや高いパフォーマンスを実現しています。

### グローバルなロードバランス

GoogleCloudのネットワークの特徴は各リージョンのデータセンターがプライベートに接続されているだけではありません。
<span style="color:crimson; font-weight:bold;">エニーキャスト</span>という技術を活用することで、アクセス元となるユーザーに近接のリージョンに、通信をルーティングしています。

### インフラを支える独自のソフトウェアの開発

Googleでは、データセンター内のサーバーを制御するための独自のソフトウェア開発を、継続的に行っています。サーバーやストレージ、データベースやネットワークを管理するソフトウェアやロギング、モニタリングなど、多様なシステム管理のソフトウェアがその中に含まれます。
たとえば、Googleのマシンの管理に<span style="color:crimson; font-weight:bold;">Borg</span>と呼ばれるクラスタ管理のソフトウェアを使用しています。Googleでは毎週数10億以上のコンテナがデプロイされており、それらはBorgで行っています。Borgを使用して得られた知見がKubernetesに活かされています。
また、<span style="color:crimson; font-weight:bold;">Colossusu</span>と呼ばれるファイルシステムや、
GoogleCloudのサービスにも立っているNoSQLデータベースのBigtable、世界規模でトランザクションの一貫を確保できるspannerというデータベースなどが活用されています。
こうしたプロダクトは、GoogleCloudのダービスやそれを支える技術としても採用されています。
GoogleCloudはまさにGoogleのエンジニアと同じような体験ができるプラットフォームと言えるでしょう。

| 技術 | 概要 |
| --- | --- |
| Borg | 分散クラスタ管理システム。OSSであるKubernetsの前身となるソフトウェア |
| Colossus | クラスタ全体に広がるファイルシステム。GFSの後継 |
| Bigtable | ペタバイトスケールのデータを処理できるNoSQLデータベース |
| Spanner | SQLライクのインターフェイスを提供し、世界規模のデータ一貫性を提供するデータベース |
| Global Software Load Blancer | 地理的ロードバランシングやサービスレベルでのロードバランシングの機能を提供 |
| Chubby | ファイルシステムのようなAPIを提供するロックサービス。複数のデータセンターにまたがったロックを制御 |


### まとめ

* Googleは世界規模でデータセンターやネットワークを整備している
* エニーキャストという技術を活用することで、アクセス元となるユーザーに近接のリージョンに通信をルーティングする
* グローバルビジネスを支えるために独自のソフトウェアを開発しており、その技術やプロダクトはGoogleCloudのサービスとして利用可能

## 10 クラウドにおけるセキュリティ対策

セキュリティ対策は、クラウドで管理するデータを保護するためにも重要となります。
GoogleCloudでは、クラウドの利用者とクラウドベンダー双方で責任を共有し、セキュリティ対策を行います。

### クラウドにおけるセキュリティの考え方

クラウドを活用する場合でも、システムのセキュリティ対策は十分に行う必要があります。
セキュリティの考え方はオンプレミスと異なるので注意が必要です。

オンプレミスの場合、システム環境全体が利用する組織の資産であり、その組織の責任において、セキュリティ対策の内容を定めます。しかしクラウドの場合は、利用者とクラウドベンダーの役割分担にもとづき、セキュリティの責任を共有した上でセキュリティ対策を行う必要があります。これをセキュリティの責任共有といいます。


### 責任範囲はクラウドのサービス形態によって異なる

セキュリティの責任範囲は、クラウドのサービス形態(IaaS/PaaS/SaaS)によって異なります。

### クラウドにおけるセキュリティ対策

GoogleCloudにはさまざまなサービスがあります。
そのため個別でサービスにおけるセキュリティ対策に加えて、GoogleCloudを利用する上で必要となる全般的なセキュリティ対策も必要となります。

* GoogleClouで必要なセキュリティ対策例

| 項目 | 対策例 |
| --- | --- |
| 組織構造 | GoogleCloudを構成する要素である組織、フォルダ、プロジェクトの利用用途を整理し、組織のセキュリティポリシーを適用する |
| 構成管理 | アプリケーションが稼働する環境と、アプリケーションとその稼働に関わるインフラの構成変更を行う環境(CI/CD環境など)を分離し、<br>それぞれの環境において適切な権限設定を行う。そうすることで不正な構成変更が発生しないようにする<br> |
| 認証と認可 | シングル・サインオンや２段階認証の導入。必要最小限の権限となるようにグループやユーザーを設計する |
| ネットワーキング | IPアドレス設計やアクセス制御、外部接続設計 |
| 暗号鍵やシークレットの管理 | 暗号鍵やパスワードなどのシークレットを安全に管理できるプロダクトを選定する |
| ログ管理 | ログの洗い出しと保存方法の検討 |


### Googleのセキュリティに対する取り組み

Googleは自らのインフラを守るためにさまざまな技術開発を独自に行うだけではなく、セキュリティ専門の研究チームもつくっています。そうした取り組みの一部を紹介します。

* Googleのセキュリティに対する取り組みの一部

| 項目 | 取り組みの内容 |
| --- | --- |
| Project Zero | セキュリティの脆弱性を発見するGoogleの研究チーム。2018年にSpectorやMeltdownというCPUの脆弱性を発見している |
| Safe Browsing | クライアントアプリケーションが不正なURLチェックできる機能を提供する |
| Beyond Corp | Googleにおけるゼロトラストセキュリティモデルの実装で、VPNを使わずにセキュアなアクセスを実現する手法 |
| gVisor | コンテナをサンドボックス化するためのプロジェクトで、アプリケーションをホストカーネルから分離できる |


### ゼロトラストネットワークとは

最近では「ゼロトラスト」というキーワードをよく見かけるようになりました。
Googleでは、2011年からゼロトラストに向けて取り組みを始め、現在はゼロトラストの原則に基づいてシステムを構成しています。
<span style="color:crimson; font-weight:bold;">ゼロトラストネットワーク</span>は、ITネットワークの新しい設計や実装のあり方を指したものです。
従来のネットワークは<span style="color:crimson; font-weight:bold;">境界型ネットワーク</span>と呼ばれ、ネットワークの境界、多くはファイアウォールといった物理的な境界で、外部ネットワークと内部ネットワークを分離しています。
そして、内部ネットワークに置けるアクセスは、基本的には信頼されたアクセスとみなされていました。
境界型ネットワークで境界の外からアクセスする場合、<span style="color:crimson; font-weight:bold;">VirtualPrivateNetwork（VPN）</span>が必要でした。
VPNとは、暗号化されたネットワーク通信を確立するための仕組みの事です。
VPNを使うと、教会内の環境とあたかも閉域接続をしているかのように通信を行えます。
また、端末からのインターネット通信が制限されたり、きめ細やかなアクセス制御が出来なかったり、といった課題がありました。
一方、ゼロトラストネットワークでは、<span style="color:crimson; font-weight:bold;">原則すべてのアクセスを信頼せずに、認証やアクセスの検証、アクセス制御といった手続き全てのアクセスにおいて実施する</span>という考え方を適用します。
境界内外を問わず、常にアクセスの認証や検証を行うので、境界型ネットワークよりもきめ細かいセキュリティネットワーク対策を実現できます。



## 11 ハイブリッドクラウドとマルチクラウド

## 12 オープンクラウド